<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>Table View Cell 自适应速成大法 | Andy矢倉</title>
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="description" content="曾梦想仗剑走天涯">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Table View Cell 自适应速成大法 | Andy矢倉">
    <meta name="twitter:description" content="曾梦想仗剑走天涯">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Table View Cell 自适应速成大法 | Andy矢倉">
    <meta property="og:description" content="曾梦想仗剑走天涯">

    
    <meta name="author" content="Andy矢倉">
    
    <link rel="stylesheet" href="/css/vno.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">

    
    <link rel="icon" href="/images/avatar-small.jpg">
    

    <meta name="generator" content="hexo"/>
    
    <link rel="alternate" type="application/rss+xml" title="Andy矢倉" href="/atom.xml">
    

    <link rel="canonical" href="http://shicang1990.github.io/2016/12/12/2016-12-12-Self-sizing-Table-View-Cells/"/>

    
      
</head>

<body class="home-template no-js">
    <script src="http://cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>

    
<header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/background-cover.jpg)">
  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/" title="前往 Andy矢倉 的主页"><img src="/images/avatar.jpg" width="80" alt="Andy矢倉 logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage for Andy矢倉">Andy矢倉</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">老板 来杯董小姐 去冰 少糖 多放点小姐</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">曾梦想仗剑走天涯</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />

        <div class="navigation-wrapper">
          <div>
          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="访问博客" class="blog-button">博客</a></li>
            
              <li class="navigation__item"><a href="/">主页</a></li>
            
              <li class="navigation__item"><a href="/archives">所有文章</a></li>
            
            </ul>
          </nav>
          </div>
          <div>
          <nav class="cover-navigation navigation--social">
  <ul class="navigation">

  <!-- Weibo-->
  
  <li class="navigation__item">
    <a href="http://weibo.com/ganmaojijie" title="我的微博" target="_blank">
      <i class='social fa fa-weibo'></i>
      <span class="label">Weibo</span>
    </a>
  </li> 


  <!-- Github -->
  
  <li class="navigation__item">
    <a href="https://github.com/shicang1990" title="查看我的GitHub主页" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>


<!-- Stack Overflow -->
        

  <!-- Google Plus -->
  

<!-- Facebook -->

  <li class="navigation__item">
    <a href="https://www.facebook.com/wiwby" title="上Facebook找我" target="_blank">
      <i class='social fa fa-facebook'></i>
      <span class="label">Facebook</span>
    </a>
  </li>

  
<!-- Twitter -->

  <li class="navigation__item">
    <a href="https://twitter.com/Andy_shicang" title="上Twitter找我" target="_blank">
      <i class='social fa fa-twitter'></i>
      <span class="label">Twitter</span>
    </a>
  </li>

  

  <li class="navigation__item">
    <a href="/atom.xml" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>


  <li class="navigation__item">
    <a href="mailto:shicang1990@gmail.com" title="邮件联系我" target="_blank">
      <i class='social fa fa-envelope'></i>
      <span class="label">Email</span>
    </a>
  </li>


  </ul>
</nav>

          </div>
        </div>

      </div>

    </div>

    <div class="panel-cover--overlay cover-purple"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single">

  <header class="post-header">
    <div class="post-meta">
      <time datetime="2016-12-12T08:26:38.000Z" class="post-list__meta--date date">12月 12 2016</time> &#8226; <span class="post-meta__tags tags">于&nbsp;
  <a class="tag-link" href="/tags/Cell/">Cell</a>, <a class="tag-link" href="/tags/TableView/">TableView</a>, <a class="tag-link" href="/tags/iOS/">iOS</a>
 </span>
      <span class="page-pv">
      &nbsp;阅读&nbsp;<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>
      </span> 
   
    </div>
    <h1 class="post-title">Table View Cell 自适应速成大法</h1>
  </header>

  <section class="post">
    <blockquote>
<p>版权所有，未经授权严禁转载！！！<br>转载地址：<a href="http://www.rockerhx.com/2016/12/12/2016-12-12-Self-sizing-Table-View-Cells/" target="_blank" rel="external">http://www.rockerhx.com/2016/12/12/2016-12-12-Self-sizing-Table-View-Cells/</a></p>
</blockquote>
<p>最近滚回成都忙房子的事情，一直没时间更新，今天在群里开到好多人在聊很多培训机构都已经辞掉iOS培训老师，关闭iOS培训课程。这尼玛回想在乔帮主时代，开发iOS还是件可以装好几年逼，而如今，日落黄昏啊。<br>纵观近几年，有太多培训机构当搅屎棍进来瞎掺和贵国的全民创业，伪造简历不说，那帮菜鸟的技术真的是辣眼睛，卧槽，好像跑偏了，今天不是来申讨培训党的，我们是正经教程，还是回到主路继续开车~~~</p>
<a id="more"></a>
<blockquote>
<p>此教程特地针对Xcode8，iOS10和Swift 3优化并完善，那么你需要使用Xode8或者更新的版本，并且需要你有AutoLayout，TableView以及Swift 3的相关知识。</p>
</blockquote>
<h2 id="I-have-a-Table-I-have-a-View-hing-TableView"><a href="#I-have-a-Table-I-have-a-View-hing-TableView" class="headerlink" title="I have a Table, I have a View, hing ~ , TableView"></a>I have a Table, I have a View, hing ~ , TableView</h2><p>不管是老司机还是新司机，日常开发中使用<code>UITableView</code>来搭建应用框架的肯定都遇到过这种尴尬：辣就是在刚入门iOS开发，相信绝大部分人针对接到产品狗要做动态列表或者有动态高度的列表需求时抽出过皮带，因为那会儿主要都是手动计算，这种需求不仅费时费力，最后bug还多的一逼。<br>其实这种需求涉及到的技术最主要的无非就是Cell的自适应，俗话说的好，只要你掌握了<code>TableView</code>，大部分应用你是手到擒来的，对于TableView的基础用法和复用早在12年就烂大街了，对于Cell自适应也都是老生常谈，之所以还搞这种教程，完全是看着群里一帮傻屌每天都在无下限的讨论一些恬不知耻的话题，Cell自适应就是重灾区。对于网上的教程也好，开源库也好，已经掌握的就赶紧滚犊子，不要浪费时间了。。。</p>
<h2 id="开始吧"><a href="#开始吧" class="headerlink" title="开始吧"></a>开始吧</h2><p>在乔帮主时代，那是的确没办法，基本上都是通过手动计算<code>Label</code>和各种可变动控件的高度，而且要是考虑屏幕旋转，那就头大咯，还好那会儿屏幕没有太多尺寸。<br>步入库克时代，大概苹果的工程师也觉得手动计算麻烦的一逼，于是有了<code>AutoLayout</code>以及开放了新的Api。</p>
<p>Objective-C:<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">CGSize</span>)systemLayoutSizeFittingSize:(<span class="built_in">CGSize</span>)targetSize;</div></pre></td></tr></table></figure></p>
<p>Swift:<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">systemLayoutSizeFitting</span><span class="params">(<span class="number">_</span> targetSize: CGSize)</span></span> -&gt; <span class="type">CGSize</span></div></pre></td></tr></table></figure></p>
<p>利用此Api，无论你是代码党还是煞笔党，配合<code>AutoLayout</code>就可以搞定Cell自适应的问题，可以说是载歌载舞啊。</p>
<p>现在，得益于<code>iOS8</code>对<code>Interface Builder</code>改进和<code>AutoLayout</code>的优化，只要是你的应用适配到<code>iOS8</code>以上，解决Cell自适应的问题那就So Easy！！！</p>
<blockquote>
<p>那么接下来你需要搞定如下几个简单步骤：</p>
<ul>
<li>使用<code>AutoLayout</code>创建你的TableView。</li>
<li>把<code>rowHeight</code>设置成<code>UITableViewAutomaticDimension</code>。</li>
<li>利用<code>estimatedRowHeight</code>设置一个预估高度或者自行实现预估高度的代理方法。</li>
</ul>
</blockquote>
<p>你先别逼逼问为什么要这么做，这是速成大法，先给你看效果才是最重要的，跟着做就行了，做完不懂再逼逼。。。</p>
<h2 id="姿势One：约会"><a href="#姿势One：约会" class="headerlink" title="姿势One：约会"></a>姿势One：约会</h2><blockquote>
<p>假设你有个煞笔客户，要让你做一个艺术家作品展示的应用，那么进入应用的第一个主页面肯定是个艺术家信息列表，而且是动态列表。但是客户需要的是快速实现，他不想听你逼逼动态列表好不好做，也不想看你在那里煞笔的炫耀技术，你特么乖乖实现就行了。</p>
</blockquote>
<p>你可以自己从头搭建工程，当然考虑到看教程的大部分都是懒逼，这里给你们准备了一份初始<a href="/others/2016-12-12-Self-sizing-Table-View-Cells/Artistry-Starter.zip">工程</a>，如果你不想搞事，劝你还是老实点用我这份比较好，Understand。。。</p>
<p align="center"><br><img src="/images/2016-12-12-Self-sizing-Table-View-Cells/0.jpg" width="(height" *="" (700="" 657))="" height="300"><br></p>

<p>接下来我们就可以开始涨姿势了，Let’s go…</p>
<h2 id="姿势Two：前戏"><a href="#姿势Two：前戏" class="headerlink" title="姿势Two：前戏"></a>姿势Two：前戏</h2><p>由于我已经帮你模拟并拆解了需求，了解并分析你就免了，跟着看就成。。。<br>打开<code>Artistry</code>工程，找到<code>Views</code>分组，点开<code>Main.storyboard</code>：</p>
<p align="center"><br><img src="/images/2016-12-12-Self-sizing-Table-View-Cells/1.png" alt=""><br></p>

<p>从左到右分别是：</p>
<ul>
<li>作为根控制器的导航控制器。</li>
<li><code>ArtistListViewController</code>负责显示艺术家列表。</li>
<li><code>ArtistDetailViewController</code>负责显示艺术家作品以及详情。</li>
</ul>
<p>让我们跑一盘，可以看到<code>ArtistListViewController</code>显示了一个艺术家的列表，我们选择第一个艺术家（Pablo Picasso），页面跳转到<code>ArtistDetailViewController</code>显示艺术家作品介绍：</p>
<p align="center"><br><img src="/images/2016-12-12-Self-sizing-Table-View-Cells/2.png" alt=""><br></p>

<p>作为一个艺术家，不应该单单只有文字的介绍，还需要图片，但是在这里我们并没看到图片信息，所以我们需要添加图片显示，那么由于图片的宽高大小并不统一，因此你不可能只用一个固定高度就能解决，而是需要基于Cell内包含内容才决定的动态高度。<br>那么我们接下来就在<code>ArtistListViewController</code>利用动态高度实现Cell的自适应。</p>
<h2 id="姿势Three：69大法"><a href="#姿势Three：69大法" class="headerlink" title="姿势Three：69大法"></a>姿势Three：69大法</h2><p>想要获得Cell的正确高度，必须自定义一个Cell并且使用AutoLayout建立正确约束。<br>这里我们可以使用<code>Command + N</code>快捷键来创建文件，Cell是属于视图结构，因此最好是放到<code>Views</code>分组下，你要不喜欢可以随便放，做项目要保持烂习惯也是你自己遭殃。<br>OK，这里我们选择<code>Cocoa Touch Class</code>创建一个名为<code>ArtistTableViewCell</code>并且继承自<code>UITableViewCell</code>的源文件。语言项肯定是整<code>Swift</code>，也不需要创建<code>Xib</code>可是文件哈，你踏马要煞笔到怼Objc我也无话可说，那到这里我劝你赶紧Q掉。<br>打开我们刚才创建的<code>ArtistTableViewCell.swift</code>并删掉系统自动生成的方法，接着我们添加如下属性：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> bioLabel: <span class="type">UILabel</span>!</div></pre></td></tr></table></figure></p>
<p>接着，点开<code>Main.storyboard</code>，在<code>ArtistListViewController</code>里选中<code>TableView</code>的<code>Cell</code>，在<code>Identity Inspector</code>就是识别检查器，<code>Command + Option + 3</code>也可以，都是一个屌意思，把<code>Class</code>栏修改为<code>ArtistTableViewCell</code>才能跟代码绑定。</p>
<p align="center"><br><img src="/images/2016-12-12-Self-sizing-Table-View-Cells/3.png" alt=""><br></p>

<p>拖一个<code>UILabel</code>到刚才的<code>Cell</code>里，并把内容改为<code>Bio</code>，然后在<code>Attributes Inspector</code>属性检查器里把<code>Lines</code>设置为0，Label要是现实多行文字这个是必须的前提，OK，搞定之后看起就想这样：</p>
<p align="center"><br><img src="/images/2016-12-12-Self-sizing-Table-View-Cells/4.png" alt=""><br></p>

<p>刚才我们设置的那个<code>Lines</code>也就是Label对应的断行属性<code>numberOfLines</code>，这个我就奶妈当到底吧，这个属性是<code>Int</code>类型，设置几就是只显示几行，设置<code>0</code>就是完整显示，千万别忘了设置，不然你就是当不插电开机的煞笔好了。</p>
<p>接下来在<code>Document Outline</code>找到刚才绑定的Cell上右键，在弹出的outlet弹出列表上把<code>ArtistTableViewCell</code>的属性<code>bioLabel</code>拖到刚才弄的内容为<code>Bio</code>的Label上链接起来，演示如下：</p>
<p align="center"><br><img src="/images/2016-12-12-Self-sizing-Table-View-Cells/5.png" alt=""><br></p>

<p>是不是憋的一逼，一开始到现在咋都不说这么做是为啥，现在就告诉你为什么，让<code>UITableViewCell</code>动态高度的秘诀是利用<code>AutoLayout</code>里有内建高度的控件比如<code>UILabel</code>这种来把Cell撑开，这种做法的前提就是必须把约束给设置完整，不然系统就没法自动计算高度。</p>
<blockquote>
<p>算了，要是不会AutoLayout，我还是给你一份快速上手教程，iOS7和iOS9两个版本，自行选择。<br>中文：<a href="http://www.tairan.com/archives/5365/" target="_blank" rel="external">iOS 7教程 - Storyboards Part1</a>，<a href="http://www.raywenderlich.com/50310/storyboards-tutorial-in-iOS-7-part-2" target="_blank" rel="external">iOS 7教程 - StoryBoards Part2</a><br>英文：<a href="https://www.raywenderlich.com/115440/auto-layout-tutorial-in-ios-9-part-1-getting-started-2" target="_blank" rel="external">Auto Layout Tutorial in iOS 9 Part 1: Getting Started</a></p>
</blockquote>
<p>刚才原理都明白了我们可以给Label拉约束了，在Storyboard可视化界面的直接快捷添加，只需要让<code>Label</code>的四边顶住Cell的四边即可，也就是给Label分别四个约束添加：</p>
<ul>
<li>leading</li>
<li>top</li>
<li>trailing</li>
<li>bottom<p align="center"><br><img src="/images/2016-12-12-Self-sizing-Table-View-Cells/6.png" alt=""><br></p>

</li>
</ul>
<blockquote>
<p>关于<code>Constraints to margins</code>这个选项这里还是说一下，这个选项是留边的做法，最开始是<code>Size Class</code>这个特性考虑不全，认为所有人都会为同一个应用在<code>Storyboard</code>里掺杂各种屏幕的页面设计，也就是<code>iWatch</code>的诞生才引入的<code>Size Class</code>特性。<br>但是大部分日常开发都是基于iPhone，然后才是iPad，iWatch，所以这个作为默认勾选在iPhone上是很多新手踩的大坑，如果没注意又不知道意思，勾选之后在不同屏幕上看到的边缘就会有留边或者被裁掉的问题。<br>这里只是演示教程，无所谓，实际开发的时候根据需求确定勾选与否即可。</p>
</blockquote>
<p>所以根据你Xcode的版本，总之就是取消勾选个<code>Constraints to margins</code>，然后上下左右四个约束的约束值：</p>
<ul>
<li>上下约束值为0</li>
<li>左右约束值为8</li>
</ul>
<blockquote>
<p>那么我们来验证一下上面做的是否满足AutoLayout的标准：</p>
<ul>
<li>控件的起始点和宽高都能确定吗？有上下左右四边约束，这是绝逼能确定起始点和宽高的，通过。</li>
<li>可变控件是否把Cell的内容视图<code>contentView</code>给顶住？Label上下两边的约束就足够顶住，通过。</li>
</ul>
<p>所以这个自动布局完全可以确定高度以便让Cell高度自适应。</p>
</blockquote>
<p>现在你的<code>ArtistTableViewCell</code>视图已经搞定，让我们跑一盘来看看：</p>
<p align="center"><br><img src="/images/2016-12-12-Self-sizing-Table-View-Cells/7.png" alt=""><br></p>

<p>不对啊，咋还是之前的屌样，What the fuck！？？？莫紧张，我们只是弄了可视化绑定部分，你以为还真的全程可视化啊，当然还是写点小代码，别太天真了骚年！！！</p>
<h2 id="姿势Four：倒挂金钩"><a href="#姿势Four：倒挂金钩" class="headerlink" title="姿势Four：倒挂金钩"></a>姿势Four：倒挂金钩</h2><p>只有正确的配置好我们自定义的Cell才能准确计算高度。<br>so，打开<code>ArtistListViewController.swift</code>，替换掉方法<code>tableView(_:cellForRowAtIndexPath:)</code>，代码搞成如下所示：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, cellForRowAt indexPath: IndexPath)</span></span> -&gt; <span class="type">UITableViewCell</span> &#123;</div><div class="line">    <span class="keyword">let</span> cell = tableView.dequeueReusableCell(withIdentifier: <span class="string">"Cell"</span>, <span class="keyword">for</span>: indexPath) <span class="keyword">as</span>! <span class="type">ArtistTableViewCell</span></div><div class="line">  </div><div class="line">    <span class="keyword">let</span> artist = artists[indexPath.row]</div><div class="line">    cell.bioLabel.text = artist.bio</div><div class="line">    cell.bioLabel.textColor = <span class="type">UIColor</span>(white: <span class="number">114</span>/<span class="number">255</span>, alpha: <span class="number">1</span>)</div><div class="line">    <span class="keyword">return</span> cell</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这代码段应该是相当简单吧，Cell复用，设置Label的内容，设置文字颜色，还有更多需要我解释的吗！？？？</p>
<p>再次跑起来，除了文字颜色变了，其他还是一个屌样，想想，我们把<code>bioLabel</code>的行数限制设置为0，取消掉行数限制，约束也设置好了，但是目前TableView还没那么智能让你想啥来啥，我们还需要告诉它让AutoLayout来负责驱动Cell的高度。</p>
<p>点开<code>ArtistListViewController.swift</code>，在<code>viewDidLoad()</code>后面加上这两句代码：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">tableView.rowHeight = <span class="type">UITableViewAutomaticDimension</span></div><div class="line">tableView.estimatedRowHeight = <span class="number">140</span></div></pre></td></tr></table></figure></p>
<p>当你把<code>rowHeight</code>这个属性设置为<code>UITableViewAutomaticDimension</code>，只要保持约束正确，AutoLayout就会自动确定Cell的高度。<br>同时还需处理的便是<code>estimatedRowHeight</code>这个属性，我们这里选择<code>140</code>这个值，只是在这个项目当中大概估算出来的，每个项目或者每个列表都需要自行处理这个值，按照语义，预估一个中间值，这样减少刷新的性能消耗。</p>
<p>好，我们再来跑跑看，列表是不是看起来就完美了😉😉😉</p>
<p align="center"><br><img src="/images/2016-12-12-Self-sizing-Table-View-Cells/8.png" alt=""><br></p>


<h2 id="姿势Five：观音坐莲"><a href="#姿势Five：观音坐莲" class="headerlink" title="姿势Five：观音坐莲"></a>姿势Five：观音坐莲</h2><p>虽然现在应该可以完整显示了，但是任然很挫，我们需要添加一些图片和艺术家大名来美化一下看起来才像样。<br>那么我们来给<code>ArtistTableViewCell</code>添加图片和艺术家名字，点开<code>ArtistTableViewCell.swift</code>添加如下代码：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> nameLabel: <span class="type">UILabel</span>!</div><div class="line"><span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> artistImageView: <span class="type">UIImageView</span>!</div></pre></td></tr></table></figure></p>
<p>我们添加了一个名为<code>artistImageView</code>的图片属性，然后在可视化里面绑定图片控件即可。</p>
<p>点开<code>Main.storyboard</code>，选到艺术家列表里的Cell，点到<code>Size Inspector</code>尺寸识别器里，把<code>Row Height</code>设置为140，这样方便给你更多控件来添加新的控件。</p>
<p align="center"><br><img src="/images/2016-12-12-Self-sizing-Table-View-Cells/9.png" alt=""><br></p>

<p>接下来我们需要改变布局和约束，切换到<code>Document Outline</code>里点开<code>Content View</code>的<code>Constraints</code>，或者在<code>Size Inspector</code>尺寸识别器里也可以，反正就是要删掉<code>BioLabel</code>的<code>leading</code>约束。</p>
<p align="center"><br><img src="/images/2016-12-12-Self-sizing-Table-View-Cells/10.png" alt=""><br></p>

<p>直接干掉Label左边的约束后会看到<code>Auto Layout</code>的警告，暂时忽略掉，我们最后会把约束给完善好。<br>现在拉住Label的左边缘，把Label左边距拖到Cell中间位置，我们需要把左半部分留出来显示图片和艺术家的名字：</p>
<p align="center"><br><img src="/images/2016-12-12-Self-sizing-Table-View-Cells/11.png" alt=""><br></p>

<p>然后拖一个<code>UILabel</code>到Cell底部，位置大概到Cell左半部分的水平居中即可，内容改为<code>Name</code>：</p>
<p align="center"><br><img src="/images/2016-12-12-Self-sizing-Table-View-Cells/12.png" alt=""><br></p>

<p>继续拖拽一个<code>UIImageView</code>控件到<code>NameLabel</code>上面：</p>
<p align="center"><br><img src="/images/2016-12-12-Self-sizing-Table-View-Cells/13.png" alt=""><br></p>

<p>最后，我们把新加的Label和ImageView绑定到代码上：</p>
<p align="center"><br><img src="/images/2016-12-12-Self-sizing-Table-View-Cells/14.png" alt=""><br></p>

<p>OK，接下来我们开始完善约束，这里我们只讲关键点，就不具体手把手教你该怎么拉约束了：</p>
<ul>
<li><code>NameLabel</code>到Cell的<code>ContentView</code>底部间距为<code>8</code>。</li>
<li><code>NameLabel</code>到<code>ImageView</code>的间距为<code>8</code>。</li>
<li><code>ImageView</code>到Cell的<code>ContentView</code>顶部间距为<code>8</code>。</li>
<li><code>ImageView</code>左边间隙到Cell的<code>ContentView</code>左边间距为<code>8</code>。</li>
<li><code>ImageView</code>右边间隙到<code>BioLabel</code>左边间距为<code>16</code>。</li>
</ul>
<p>由于BioLabel的内容为动态，所以即便是ImageView的上下左右四个约束都确定了也不能确定其frame。这里我们需要把ImageView控件的宽度大概控制到屏幕宽度的一半，做法有很多，这里只介绍一种。<br>选中Cell的<code>ContentView</code>和<code>ImageView</code>，使用约束快捷工具，给二者建立一个<code>Equal Widths</code>的约束即可：</p>
<p align="center"><br><img src="/images/2016-12-12-Self-sizing-Table-View-Cells/15.png" alt=""><br></p>

<p>不是说好的一半么，那就在<code>Document Outline</code>里选到刚才添加的<code>Equal Widths</code>约束，在<code>Size Inspector</code>尺寸识别器里把<code>multiplier</code>设置为<code>0.5</code>。</p>
<p align="center"><br><img src="/images/2016-12-12-Self-sizing-Table-View-Cells/16.png" alt=""><br></p>

<p>这样的话，ImageView的宽度就只有屏幕宽度的一半了。<br>我们接着把剩下的约束给怼完：</p>
<ul>
<li>选中<code>ImageView</code>和<code>NameLabel</code>使用<code>Equal Width</code>约束让二者宽度相等。</li>
<li>选中<code>ImageView</code>和<code>NameLabel</code>使用<code>Horizontal Centers</code>约束让NameLabel居中与ImageView。</li>
</ul>
<p>那么现在我们已经把所有的约束都添加完毕，此时AutoLayout还是会报一些黄色警告。做开发以来，撸主最讨厌的就是警告，不管是编码还是可视化，必须全部消除。<br>在<code>Document Outline</code>选中<code>Content View</code>，然后使用<code>Resolve Auto Layout Issues</code>快捷工具，利用<code>All Views</code>分栏下的<code>Update Frames</code>功能即可让ContentView下的所有子视图的Frame都正确更新，消除警告。</p>
<p align="center"><br><img src="/images/2016-12-12-Self-sizing-Table-View-Cells/17.png" alt=""><br></p>

<p>可视化部分已经完成了，那么我们开始进行编码工作。点开<code>ArtistListViewController.swift</code>，在<code>tableView(_:cellForRowAtIndexPath:)</code>方法体内的bioLabel字体颜色设置代码后面加上代码：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">cell.artistImageView.image = artist.image</div><div class="line">cell.nameLabel.text = artist.name</div><div class="line">cell.nameLabel.backgroundColor = <span class="type">UIColor</span>(red: <span class="number">1</span>, green: <span class="number">152</span> / <span class="number">255</span>, blue: <span class="number">0</span>, alpha: <span class="number">1</span>)</div><div class="line">cell.nameLabel.textColor = <span class="type">UIColor</span>.white</div><div class="line">cell.nameLabel.textAlignment = .center</div><div class="line">cell.selectionStyle = .<span class="keyword">none</span></div></pre></td></tr></table></figure></p>
<p>再次运行，这下看起来是不是很好多了，等等先别慌，继续往下滚动，到<code>Georgia O’Keeffe</code>你在看看是不是感觉有些奇怪。</p>
<p align="center"><br><img src="/images/2016-12-12-Self-sizing-Table-View-Cells/18.png" alt=""><br></p>

<p>大家看到NameLabel的纵向被拉伸了，不必精慌，我们继续完善。</p>
<p>点开<code>Main.storyboard</code>，选到<code>NameLabel</code>并创建一个到Cell底边的间隙约束，约束值也是<code>8</code>。然后在<code>Document Outline</code>选中刚才创建的约束，这时候你会看到刚创建的约束和之前创建的底边约束一模一样，先别慌，随便选一个，跟着做，看完你就不逼逼了。<br>选中约束之后切换到<code>Size Inspector</code>尺寸识别器里，把<code>Relation</code>一栏改为<code>Greater Than or Equal</code>：</p>
<p align="center"><br><img src="/images/2016-12-12-Self-sizing-Table-View-Cells/19.png" alt=""><br></p>

<p>然后我们把另外一条一样的约束选中，把<code>priority</code>这个优先级选项值改为<code>250</code>：</p>
<p align="center"><br><img src="/images/2016-12-12-Self-sizing-Table-View-Cells/20.png" alt=""><br></p>

<p>好，这里我们来解释下刚才都干了什么，两条相同的约束：</p>
<ul>
<li>一条约束关系是<code>Greater Than or Equal</code>大于等于关系，优先级值为<code>1000</code>。</li>
<li>一条约束关系是<code>Equal</code>等于关系，优先级值为<code>250</code>。</li>
</ul>
<p>熟悉<code>AutoLayout</code>的同学都知道，优先级为<code>1000</code>的是默认优先级，这个数值越大优先级就越高，那为什么要选<code>250</code>呢？因为苹果设计就是控件的<code>抗压缩</code>和<code>仿拉伸</code>属性默认优先级的值为<code>251</code>，所以避免和整个控件优先级冲突那就小一点。<br>这样来设置约束，就是当整个Cell高度过高，NameLabel和Cell的间隙过大是舍弃那条约束值为8的约束。<br>现在跑一盘，看看是不是没有拉伸了？</p>
<h2 id="未完待续。。。"><a href="#未完待续。。。" class="headerlink" title="未完待续。。。"></a>未完待续。。。</h2>
  </section>

</article>
<section class="read-more">
           
    
        
        
               
            <div class="read-more-item">
                <span class="read-more-item-dim">更早的文章</span>
                <h2 class="post-list__post-title post-title"><a href="/2016/05/31/2016-05-31-Failed-Import-Bridging-Header/" title="Failed to import bridging header 的奇葩解决方案">Failed to import bridging header 的奇葩解决方案</a></h2>
                <p class="excerpt">
                
                本人是个升级控，只要有需要升级的看看日志没啥问题就开整，等了大半年的Cocoapods的1.0.0终于出正式版本了，介于0.38.0到0.39.0的痛苦过程，心里有点小担心，不过那时还好是Objective-C，问题出在配置上都可以stackoverflow解决，这次要面对这次还要多面临Swift的挑战，废话太多了，直接开整。
升级的过程还是老套路：
1sudo gem install cocoapods
老套路还是还是老问题/usr下路径权限不够，试着改变权限：
1sudo chown $(whoami):admin /usr/local &amp;amp;&amp;amp; sudo chown -R $(whoami):admin /usr/local
1sudo chown $(whoami):admin /usr/bin &amp;amp;&amp;amp; sudo chown -R $(whoami):admin /usr/bin
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2016-05-30T16:06:05.000Z" class="post-list__meta--date date">5月 31 2016</time> &#8226; <span class="post-list__meta--tags tags">于&nbsp;
  <a class="tag-link" href="/tags/Xcode/">Xcode</a>
</span><a class="btn-border-small" href="/2016/05/31/2016-05-31-Failed-Import-Bridging-Header/">继续阅读</a></div>
                       
            </div>
        
     
   
   
  
</section>

            
            <footer class="footer">
    <span class="footer__copyright">
        本站点采用 <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>
    </span>
    <span class="footer__copyright">
        基于 <a href="http://hexo.io">Hexo</a> 搭建，感谢 <a href="https://pages.github.com/">GitHub Pages</a> 提供免费的托管服务
    </span>
    <span class="footer__copyright">
        &copy; 2016 - 本站由 <a href="/">@Monniya</a> 创建,
        使用 <a href="https://github.com/monniya/hexo-theme-new-vno ">hexo-theme-new-vno</a> 主题,
        修改自 <a href="https://github.com/lenbo-ma/hexo-theme-vno" target="_blank">Vno</a>, 原创出自<a href="http://github.com/onevcat/vno" target="_blank">onevcat</a>
    </span>
</footer>
        </div>
    </div>

    

     
    
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?f1811f144f64379f918cf1ef7bf3f3cb";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>



    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
    
    </script>
    
</body>
</html>
